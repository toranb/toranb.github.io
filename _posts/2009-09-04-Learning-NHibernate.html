---
layout: post
title:  "Learning NHibernate"
date:   2009-09-04 6:00:00
categories: blog archive
---

<p>A few months back, I decided it was time to leave stored procedure development behind and focus more on solving true business problems.  The first concept I had to get my head around was <a href='http://devlicio.us/blogs/casey/archive/2009/02/12/ddd-there-is-no-database.aspx' target='_blank'>persistence Ignorance</a>.  The idea is simple: I shouldn't have to think about persisting my business objects - something should do this for me and stay out of my way. </p>

<p>Developers tend to view data access strategy as the most religious of topics, and I was no different ... until I realized that my business users couldn't care less about the details of persistence.  Beyond reporting, they never once asked me to store something in a database for them.  This was an eye opener for me as of recent, because I'm always trying to provide value and true ROI for my customers.  Instead of having to write a mess of stored procedures for each project, I can focus on the things my business users care about. </p> 

<p>But rather than wait for the usual greenfield application to learn an <a href='http://en.wikipedia.org/wiki/Object-relational_mapping' target='_blank'>object relational mapper</a> (ORM), I decided to refactor a previous application to see how flexible something like NHibernate would be.</p>

<p>Why did I pick <a href='https://www.hibernate.org/343.html' target='_blank'>NHibernate</a> you ask?  </p>

<ul>

<li>The <a href='http://summerofnhibernate.com/' target='_blank'>Summer of NHibernate Screencast Series</a> is excellent</li>

<li>It's Open Source Software maintained by <a href='http://ayende.com/Blog/' target='_blank'>Ayende Rahien</a></li>

<li>More mature than anything Microsoft has to offer</li>

<li>Testability</li>

<li>You don't need to inherit from a base class or implement an interface (<a href='http://en.wikipedia.org/wiki/Plain_Old_CLR_Object' target='_blank'>POCO</a> support)</li>

<li>LINQ to NHibernate 1.0 was <a href='http://ayende.com/Blog/archive/2009/07/26/nhibernate-linq-1.0-released.aspx' target='_blank'>released in July</a></li>

<li>The <a href='http://codebetter.com/blogs/jeremy.miller/' target='_blank'>people</a> I most <a href='http://devlicio.us/blogs/Tim_Barcz/' target='_blank'>respect</a> are using it</li>

</ul>

<p>Some of the real fears I had about using <a href='http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx' target='_blank'>LINQ to SQL</a> were related to its inability to provide inheritance for objects represented in different tables.  For some odd reason you MUST have everything in 1 table to do inheritance.  Also the <a href='http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx' target='_blank'>wording from Microsoft last year</a> about 'support' for LINQ to SQL left me feeling like the ado.net team simply walked away from the technology stack altogether when it was decided that the Entity Framework would be the 'one true way' for data access on the Microsoft platform.  And to be clear, LINQ to SQL is not a true ORM.</p>

<p>That brings me to the <a href='http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx' target='_blank'>Entity Framework</a> (EF) ... just the fact that you have to explicitly tell EF that you 'want to lazy load' was enough for me to walk.  But the lack of true POCO support here - you must inherit from a base class or implement an interface at the very least - is another big issue for me because I don't like to tip toe around a ton of infastructure just to work with my business objects.  In my opinion, a good ORM should stay out of the way so I can do my job.  Not to mention the pain that comes along with the drag and drop designer ... need I say more?</p>

<p>I will be starting a series dedicated to NHibernate that will cover some of the pain I felt trying to learn the ORM and back it into a legacy system.  A list of the topics are shown below.</p>

<ul>

<li>How to get up and running with NHibernate</li>

<li>How can I model relationships between objects?</li>

<li>I need to track all changes using some type of audit table - can I do this?</li>

<li>How can I model inheritance?</li>

<li>But my application does some valiation, how do I stop NHibernate from persisting these changes?</li>

<li>What about unit testing?  Is it harder or easier with NHibernate?</li>

<li>What about web services?  Can I use something like WCF with NHibernate?</li>

<li>What about this LINQ to NHibernate thing?</li>

<li>How to setup <a href='http://nhprof.com/' target='_blank'>NHProf</a> to do some profiling</li>

</ul>

<p>I learned a ton over the last 6 weeks and hope to share the good/bad/ugly so that others who plan to adopt NHibernate will have a trail to follow.</p>
